+function(){this.COLS=17,this.ROWS=17,this.MAX_CHARS=255,this.MAX_LEVEL=COLS*ROWS/(COLS+ROWS)+COLS*ROWS,this.MIN_COMPLEXITY=15,this.LOCK_CHARS=/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/g,this.TITLE="AllCrossword",this.HOST=$.trim(document.body.getAttribute("data-host")),this.URL=$.trim(document.body.getAttribute("data-url"))}(),+function(){Array.prototype.clean=function(){for(;this.length>0;)this.pop()},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},this.a2a_config=window.a2a_config||{},a2a_config.linkname=TITLE,a2a_config.linkurl=URL,a2a_config.onclick=1,$(window).on("load",function(){getLang("any"),resizeCells();var t=$("#callback");t.length&&showModal(t.attr("data-head"),t.html(),["dismiss"]);var a=$("#layout");a.length&&init($.parseJSON(a.text()));var e=$("li.external");e.on("click",function(){showModal("info","<div class='load-external text-center'><img src='"+HOST+"/_assets/loader.gif' /></div>",["dismiss"]);var t=$("div.modal-body");console.log(HOST+"/"+($(this).find("a").text().toLowerCase().replace(/\s/g,"_")+".html")),t.load(HOST+"/"+$(this).find("a").text().toLowerCase().replace(/\s/g,"_")+".html",function(){var t=$("div.load-external");t.hide()})})}),$(window).on("resize",function(){resizeCells()}),$("a[role='share']").on("click",function(){{var t=["http://www.reddit.com/submit?url=http://"+URL+"&title="+TITLE,"https://twitter.com/intent/tweet?status="+TITLE+"%20http://"+URL+"&related=micropat","https://www.facebook.com/sharer/sharer.php?u=http://"+URL+"&t="+TITLE+"&v=3","https://plus.google.com/share?url=http://"+URL,"https://www.diigo.com/post?url=http://"+URL+"&title="+TITLE+"&desc=","http://www.stumbleupon.com/submit?url=http://"+URL+"&title="+TITLE,"https://www.tumblr.com/share/link?url=http://"+URL+"&name="+TITLE+"&description="],a=$(window),e=Number($(this).attr("parm-w")),o=Number($(this).attr("parm-h")),s=Math.round((a.width()-e)/2),n=Math.round((a.height()-o)/2);0>s||0>n?window.open(t[$(this).attr("ind")],"_blank"):window.open(t[$(this).attr("ind")],"_blank","width= "+e+", height= "+o+", left="+s+", top="+n)}}),$(document).on("click","a[href='#']",function(t){t.preventDefault()}),$("div.toggler").on("click",function(){var t=$("div.bar");t.toggleClass("hidden-xs")})}(),+function(){this.callAjax=function(t,a,e){return $.ajax({beforeSend:function(){void 0===e&&showModal("processing","",[])},type:"POST",url:HOST+t,data:a})},this.getLang=function(t){var a=$("select[name=language]");return a.length&&a.load(HOST+"/languages.xml",function(){a.prepend("<option value="+t+">"+t+"</option>"),window.data||(data={lang:a.attr("data-last")}),findActiveItem();var e=$("#list");e.length&&search()}),a},this.showModal=function(t,a,e,o){var s={processing:"<span class='glyphicon glyphicon-time text-primary'></span>&nbsp;&nbsp;<strong>PROCESSING...</strong>",warning:"<span class='glyphicon glyphicon-warning-sign text-danger'></span>&nbsp;&nbsp;<strong>WARNING</strong>",info:"<span class='glyphicon glyphicon-info-sign text-info'></span>&nbsp;&nbsp;<strong>NOTIFICATION</strong>",data:"<span class='glyphicon glyphicon-tasks text-warning'></span>&nbsp;&nbsp;<strong>DATA COLLECTION</strong>",captcha:"<span class='glyphicon glyphicon-ok-sign text-info'></span>&nbsp;&nbsp;<strong>VALIDATION</strong>",services:"<span class='glyphicon glyphicon-briefcase text-success'></span>&nbsp;&nbsp;<strong>SERVICES</strong>",report:"<span class='glyphicon glyphicon-comment text-warning'></span>&nbsp;&nbsp;<strong>FEEDBACK</strong>"},n={dismiss:"<button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>","continue":"<button type='button' class='btn btn-danger' id='modal-button-continue'>Continue</button>"},u="<div class='progress progress-striped active'><div class='progress-bar'></div></div>",i=$("#myModal"),r=i.find("div.modal-content div.main");if(r.find("button").off("click"),r.each(function(){$(this).html("")}),$("<h4 />",{"class":"modal-title",html:s[t]}).appendTo(r.eq(0)),"captcha"===t){var l=$("<form />");l.appendTo(r.eq(1)),$("<div />",{id:"captcha"}).appendTo(l),grecaptcha.render("captcha",{sitekey:"6LdmeAITAAAAAEo_rElBlgJFyw_fKAkcRkIMVw3V",theme:"light"})}else $("processing"===t?u:"<p>"+a+"</p>").appendTo(r.eq(1));e.forEach(function(t){$(n[t]).appendTo(r.eq(2))}),"function"==typeof o&&o(),i.modal("show")}}(),+function(){this.search=function(){$(document).on("click","menu a",function(){$(this).parent().hasClass("active")||$(this).parent().hasClass("disabled")||t(isNaN($(this).text())?$(this).attr("id"):$(this).text())});var t=function(t){var e=$("form"),o={language:e.find("option:selected").val(),author:e.find("input[name='author']").val().replace(LOCK_CHARS,""),minimum:e.find("input[name='minimum']").val(),maximum:e.find("input[name='maximum']").val(),results:e.find("input[name='results']").val(),order:e.find("input:checked").val(),page:t},s=$("#list");s.find("div.loader").removeClass("hide"),s.find("h4").addClass("hide"),s.find("div.view").css("display","none"),callAjax("/search",$.param(o),1).done(function(t){t=$.parseJSON(t),a(t)}).fail(function(){handleError()})},a=function(t){var a,e,o,s=$("form"),n=$("#list");if(s.find("input[name='author']").val(t.criteria.author),s.find("input[name='minimum']").val(t.criteria.minimum),s.find("input[name='maximum']").val(t.criteria.maximum),s.find("input[name='results']").val(t.criteria.results),0===t.total)n.find("h4").removeClass("hide");else{var u=[t.criteria.language.toUpperCase(),""===t.criteria.author?"ANY":t.criteria.author.toUpperCase(),"30"===t.criteria.minimum&&"100"===t.criteria.maximum?"ANY":"FROM "+t.criteria.minimum+" TO "+t.criteria.maximum,t.criteria.results+" PER PAGE",t.criteria.order.toUpperCase()],a=n.find("div.criteria span");a.each(function(t){$(this).text(u[t])});var a=n.find("div.pages span");if(a.text(t.total),a=n.find("menu"),a.html(""),t.pages>1){var i=t.criteria.page>2?t.criteria.page-2:1,r=i+5;r>t.pages&&(r=t.pages+1,i=r-5>0?r-5:i),e=$("<ul />",{"class":"pagination"}).appendTo(a),o=$("<li />",{"class":1==t.criteria.page?"disabled":""}),o.appendTo(e),o.html("<a href='#' id='1' title='"+(1==t.criteria.page?"":"First")+"'><span aria-hidden='true'>&laquo;</span></a>");for(var l=i;r>l;l++)o=$("<li />",{"class":t.criteria.page==l?"active":""}),o.appendTo(e),o.html("<a href='#'>"+l+"</a>");o=$("<li />",{"class":t.criteria.page==t.pages?"disabled":""}),o.appendTo(e),o.html("<a href='#' id='"+t.pages+"' title='"+(t.criteria.page==t.pages?"":"Last")+"'><span aria-hidden='true'>&raquo;</span></a>")}a=n.find("div.output"),a.html(""),$.each(t.records,function(){e=$("<div />",{"class":"item"}),e.appendTo(a),o=$("<label />",{"class":"show author"}),o.appendTo(e),$("<strong />",{text:this.label}).appendTo(o),$("<label />",{"class":"show date pull-left",text:"any"===t.criteria.language?this.language:this.published_at}).appendTo(e),o=$("<label />",{"class":"show level pull-right text-danger"}),o.appendTo(e),$("<strong />",{text:parseFloat(this.complexity.toFixed(2))}).appendTo(o),$("<div />",{"class":"clearfix"}).appendTo(e),o=$("<a />",{"class":"blocks show",href:HOST+"/crossword/"+this.id}),o.appendTo(e),o.html(this.scheme.replace(/0/g,'<span class="show pull-left empty"></span>').replace(/1/g,'<span class="show pull-left box"></span>')),$("<div />",{"class":"clearfix"}).appendTo(o)}),n.find("div.view").fadeIn("slow")}n.find("div.loader").addClass("hide")},e=$("button");e.on("click",function(){var a=$("div.loader");a.hasClass("hide")&&t(1)}),function(){var a=$("menu");t(a.attr("id"))}()},this.init=function(t){var a,e,o,s=$("div.canvas");window.layout=t,o=$("nav div.blockquote small"),window.data={id:o.eq(0).parent().attr("data-val"),author:o.eq(3).attr("data-val"),nick:{id:o.eq(0).attr("data-val"),label:o.eq(0).text()},lang:o.eq(1).text(),complexity:o.eq(2).attr("data-val"),published:o.eq(3).text()},data.mode=s.attr("data-mode"),data.view="create"===data.mode?"build":data.mode,$.each(t.cells,function(t){a=$("<span/>",{"class":"show pull-left"}),a.appendTo(s),$("<input/>",{type:"text","class":"show pull-left text-center"+(""===this.val?"create"===data.mode?" waiting":" empty":""),maxlength:"1",id:t,row:this.row,col:this.col,"data-val":"edit"==data.mode?this.val:""}).appendTo(a),$("<small/>",{"class":"indexing",text:this.lab}).appendTo(a)}),$("<div />",{"class":"clearfix"}).appendTo(s),o=$("#progress"),o.length&&(o=o.text().split(","));var n=s.find("input");n.each(function(a){$(this).hasClass("empty")&&$(this).attr("disabled",!0),""===t.cells[a].val||"edit"!==data.mode&&"continue"!==data.mode||$(this).val("edit"===data.mode?$(this).attr("data-val"):$.trim(o[a])),"edit"===data.mode&&$(this).attr("readonly",!0)}),drawLists(),o=$("ul.options a"),window.commands=[],o.each(function(){e=$(this).attr("data-action"),void 0!==e&&("save"!==e||"start"!==data.mode&&"continue"!==data.mode||(e="wip"),commands[e]=$(this))}),assignations()},this.assignations=function(){cellEvents(),textareaEvents(),("start"===data.mode||"continue"===data.mode)&&($(document.body).on("keyup paste",function(){window.done||checkProgress(!0)}),checkProgress()),window.commands.switcher&&window.commands.switcher.on("click",function(){switchMode()}),window.commands.save&&window.commands.save.on("click",function(){saveChanges()}),window.commands.publish&&window.commands.publish.on("click",function(){publishWork()}),window.commands.reload&&window.commands.reload.on("click",function(){reloadCrossword()}),window.commands["delete"]&&window.commands["delete"].on("click",function(){deleteCrossword()}),window.commands.clear&&window.commands.clear.on("click",function(){clearCrossword()}),window.commands.moveleft&&window.commands.moveleft.on("click",function(){moveCrossword("left")}),window.commands.moveright&&window.commands.moveright.on("click",function(){moveCrossword("right")}),window.commands.moveup&&window.commands.moveup.on("click",function(){moveCrossword("top")}),window.commands.movedown&&window.commands.movedown.on("click",function(){moveCrossword("bottom")}),window.commands.wip&&window.commands.wip.on("click",function(){saveProgress()}),window.commands.discard&&window.commands.discard.on("click",function(){discardProgress()}),window.commands.reveal&&window.commands.reveal.on("click",function(){revealSolution()}),window.commands.report&&window.commands.report.on("click",function(){reportError()}),window.commands.embed&&window.commands.embed.on("click",function(){showModal("services",largeModals("embed"),["dismiss"])})},this.resizeCells=function(){var t=$("div.canvas");if(t.length){var a=$("div#tabs"),e=t.width();t.css("height",e),a.css("height",e)}},this.cellEvents=function(){var t=$("div.canvas input");t.off("focus blur keydown"),t.on("focus",function(){selectCell($(this))}).on("blur",function(){leaveCell($(this))}).on("keydown",function(t){navigateCells(t,$(this))})},this.selectCell=function(t){t.removeClass("waiting").select()},this.leaveCell=function(t){t.val(inspectCellValue(t.val())),""!==t.val()||"create"!==data.mode&&"edit"!==data.mode||t.addClass("waiting")},this.navigateCells=function(t,a){var e=t.charCode||t.keyCode||0,o=Number(a.attr("id")),s=$("div.canvas input");if(e>=37&&40>=e){t.preventDefault();for(var n=o,u=39>e?-1:s.length;n!==u&&!(0>n||n>=s.length);n>u?n-=37===e||39===e?1:COLS:n+=37===e||39===e?1:COLS)if(n!==o&&!s.eq(n).is(":disabled")){$(this).blur(),s.eq(n).focus();break}}},this.inspectCellValue=function(t){return t.charAt(0).replace(LOCK_CHARS,"")},this.getCellValues=function(){var t=$("div.canvas input");t.each(function(t){layout.cells[t].lab="",layout.cells[t].val=inspectCellValue($(this).val())})},this.swapCells=function(t,a){var e=$("div.canvas input"),o=e.eq(t).val();e.eq(t).val(e.eq(a).val()).toggleClass("waiting",""===e.eq(t).val()),e.eq(a).val(o).toggleClass("waiting",""===e.eq(a).val())},this.textareaEvents=function(){var t=$("textarea");t.on("blur",function(){$(this).val().length>MAX_CHARS&&$(this).val($(this).val().substring(0,MAX_CHARS+1))}).on("keydown",function(t){var a=t.charCode||t.keyCode||0;return $(this).val().length<=MAX_CHARS||a>7&&10>a||a>=37&&40>=a})},this.drawLists=function(){var t,a,e=$("ol");for(e.each(function(){$(this).empty()}),i=0;i<2;i++)a="hor"===a?"ver":"hor",$.each(layout.words[a],function(){"create"===data.mode||"edit"===data.mode?(t=$("<li />",{value:this.ind}),t.appendTo(e.eq(i)),$("<input />",{type:"text",value:this.word,"class":"form-control",readonly:"true"}).appendTo(t),$("<textarea />",{"class":"form-control","data-dir":a,text:this.def}).appendTo(t)):$("<li />",{value:this.ind,text:this.def}).appendTo(e.eq(i))});var o=$("ol textarea");o.off("blur keydown"),textareaEvents()},this.checkProgress=function(t){var a=$("div.canvas input:not(.empty)"),e=a.filter(function(){return matchValues($(this).val(),layout.cells[$(this).attr("id")].val)}),o=$("div.indicator small"),s=Math.round(e.length/a.length*100);o.text(s+"%"),100===s&&(window.done=!0,t&&showModal("info",getMessage(7),["dismiss"]))},this.switchMode=function(){var t=$("div.canvas input"),a=$("div.canvas small"),e=$("ol textarea");if("edit"===data.view)t.each(function(){$(this).attr("disabled",!1),$(this).attr("readonly",!1),""===$(this).val()&&$(this).removeClass("empty").addClass("waiting")}),cellEvents(),e.each(function(){$(this).attr("disabled",!0)}),a.each(function(){$(this).text("")});else{var o,s,n,u,i,r,l=$("ol input"),d=0,c=0;getCellValues(),resetWords();for(var i=0,r=layout.cells.length;r>i;i++)if(t.eq(i).attr("readonly",!0).removeClass("waiting"),""!==layout.cells[i].val){if(o={left:0===layout.cells[i].col?"":layout.cells[i-1].val,right:layout.cells[i].col===COLS-1?"":layout.cells[i+1].val,top:0===layout.cells[i].row?"":layout.cells[i-COLS].val,bottom:layout.cells[i].row===ROWS-1?"":layout.cells[i+COLS].val},""===o.left&&""===o.right&&""===o.top&&""===o.bottom){layout.cells[i].val="",t.eq(i).attr("disabled",!0).addClass("empty").val("");continue}if(d++,s="",""===o.left&&""!==o.right&&(s="hor"),""===o.top&&""!==o.bottom&&(s=""===s?"ver":"both"),""!==s){layout.cells[i].lab=++c,a.eq(i).text(layout.cells[i].lab);for(var h=0,p="both"===s?2:1;p>h;h++)"both"===s&&(s="hor"),n="",u=layout.cells.filter("ver"===s?function(t){return t.row>=layout.cells[i].row&&t.col===layout.cells[i].col}:function(t){return t.row===layout.cells[i].row&&t.col>=layout.cells[i].col}),$.each(u,function(){return""===this.val?!1:void(n+=this.val)}),u="",l.each(function(t){return $(this).val()===n?void(u=e.eq(t).val()):void 0}),layout.words[s].push({ind:c,word:n,def:u}),s="ver"}}else t.eq(i).attr("disabled",!0).addClass("empty");drawLists(),getComplexity(d)}u=data.view,data.view="edit"===u?"build":"edit",commands.switcher.html(commands.switcher.html().replace(u.capitalize(),data.view.capitalize()))},this.saveChanges=function(){"build"==data.view?showMessage(3):data.complexity<MIN_COMPLEXITY?showMessage(4):data.complexity<2*MIN_COMPLEXITY&&"N/A"!==data.published?showMessage(10):(data.pub=0,"create"==data.mode?getAuthor():sendAuthor(data.author))},this.publishWork=function(){"build"==data.view?showMessage(3):data.complexity<2*MIN_COMPLEXITY?showMessage(5):showModal("info","Congratulation! You are about to pubish your crossword.<br /><strong>This action will also save your latest changes.</strong>",["continue","dismiss"],function(){var t=$("#modal-button-continue");t.on("click",function(){data.pub=1,"create"==data.mode?getAuthor():sendAuthor(data.author)})})},this.reloadCrossword=function(){var t=function(){var t=$("#modal-button-continue");t.on("click",function(){window.location.reload()})};showModal("warning",getMessage(2),["continue","dismiss"],t)},this.deleteCrossword=function(){showModal("warning",getMessage(6),["continue","dismiss"]);var t=$("#modal-button-continue");t.on("click",function(){callAjax("/settings/delete",{id:data.id}).done(function(){window.location.reload()}).fail(function(){handleError()})})},this.clearCrossword=function(){if("edit"===data.view)showMessage(0);else{var t=function(){var t=$("#modal-button-continue");t.on("click",function(){var t=$("div.canvas input"),a=$("#myModal");t.each(function(){"start"===data.mode||"continue"===data.mode?($(this).val(""),checkProgress()):$(this).addClass("waiting").val("")}),a.modal("hide")})};showModal("warning",getMessage(1),["continue","dismiss"],t)}},this.moveCrossword=function(t){if("edit"===data.view)showMessage(0);else{var a=$("div.canvas input").not(":input.waiting");if(!a.length)return;if(a=getPosition(t),a="left"===t||"top"===t?a-1:a+1,0>a||a===COLS||a===ROWS)return;for(var e=a;"right"===t||"bottom"===t?e>0:"left"===t?e<COLS-1:e<ROWS-1;"left"===t||"top"===t?e++:e--)a=$("div.canvas input["+("left"===t||"right"===t?"col":"row")+" = "+e+"]"),a.each(function(){var a=Number($(this).attr("id"));swapCells(a,"left"===t?a+1:"right"===t?a-1:"top"===t?a+COLS:a-COLS)})}},this.saveProgress=function(){if("continue"==data.mode)sendProgress();else{showModal("data",largeModals("contact"),["continue","dismiss"]);var t=$("#modal-button-continue");t.on("click",function(){var t=$("#email");checkEmail(t.val())?(data.contact=t.val(),showModal("captcha","",["continue","dismiss"],sendValidation)):t.val("Incorrect Email")})}},this.discardProgress=function(){showModal("warning",getMessage(9),["continue","dismiss"]);var t=$("#modal-button-continue");t.on("click",function(){var t=$("#progress");callAjax("/settings/discard",{id:t.attr("data-ref")}).done(function(){window.location=HOST}).fail(function(){handleError()})})},this.revealSolution=function(){showModal("warning",getMessage(8),["continue","dismiss"],function(){var t=$("#modal-button-continue");t.on("click",function(){var t=$("div.canvas input"),a=$("#myModal");$.each(layout.cells,function(a){""!==this.val&&t.eq(a).val(this.val)}),a.modal("hide"),checkProgress(!1)})})},this.reportError=function(){showModal("report",largeModals("report"),["continue","dismiss"]);var t=$("#modal-button-continue");t.on("click",function(){var t=$("#complaint");if(data.complaint=$.trim(t.val().substring(0,MAX_CHARS+1)),0===data.complaint.length){var a=$("#myModal");a.modal("hide")}else data.contact="",showModal("captcha","",["continue","dismiss"],sendValidation)})},this.largeModals=function(t,a){var e=[];if("complexity"===t)e.push("<strong>CROSSWORD BUILT SUCCESFULLY:</strong><br /><br />"),e.push("Number of horizontal words:&nbsp;&nbsp;<strong>"+layout.words.hor.length+"</strong><br />"),e.push("Number of vertical words:&nbsp;&nbsp;<strong>"+layout.words.ver.length+"</strong><br />"),e.push("Total of words:&nbsp;&nbsp;<strong>"+(layout.words.hor.length+layout.words.ver.length)+"</strong><br />"),e.push("Total of characters:&nbsp;&nbsp;<strong>"+a.chars+"</strong><br />"),e.push("Average characters per word:&nbsp;&nbsp;<strong>"+parseFloat(a.average.toFixed(2))+"</strong><br /><br />"),e.push("<strong>COMPLEXITY LEVEL:&nbsp;&nbsp;<span class='text-danger'>"+parseFloat(data.complexity.toFixed(2))+"</span></strong>");else if("author"===t)e.push("<strong>Please, enter your email address to continue</strong><br />"),e.push("<small>A link to this crossword will be sent to your inbox so you can edit it.</small><br /><br />"),e.push("<input type='text' class='form-control' id='email' value='"+(a||"")+"' />");else if("nicks"===t)e.push("<strong>Please, select the language of this crossword and enter an author</strong><br /><br />"),e.push("<label for='language'>Language</label>"),e.push("<select name='language' class='form-control'></select><br />"),e.push("<label for='author'>Author</label><br />"),e.push("<small class='text-warning'>Use only alphanumerical characters with no spaces</small>"),e.push("<input type='text' name='author' maxlength='20' class='form-control' />"),e.push("<div class='blockquote'>"),""!==data.nicks&&$.each(data.nicks,function(){e.push("<div class='wrapper'>"),e.push("<div class='holder'>"),e.push("<input type='radio' name='nick' data-val='"+this.label+"' value='"+this.id+"'"+(this.label===data.nick.label?"checked":"")+" />"),e.push("</div>"),e.push("<div class='holder'>&nbsp;"+this.label+"&nbsp;&nbsp;&nbsp;&nbsp;</div>"),e.push("</div>")}),e.push("</div>"),e.push("<div class='alert alert-warning hide' role='alert'></div>");else if("embed"===t)e.push("CHOOSE A VIEW MODE AND COPY THE CODE BELLOW IT TO embed THIS CROSSWORD IN YOUR SITE<br /><hr /><br />"),e.push("<strong>Horizontal Layout</strong><br />"),e.push("<textarea class='form-control'>"),e.push("<iframe src='http://"+$.trim(URL)+"/embed' width='1150px' height='650px' marginwidth='0' marginheight='0' frameborder='0'></iframe>"),e.push("</textarea><br />"),e.push("<strong>Vertical Layout</strong><br />"),e.push("<textarea class='form-control'>"),e.push("<iframe src='http://"+$.trim(URL)+"/embed' width='550px' height='1150px' marginwidth='0' marginheight='0' frameborder='0'></iframe>"),e.push("</textarea>");else if("contact"===t)e.push("<strong>Please, enter your email address to continue</strong><br />"),e.push("<small>A link to a saved with your progress version of this crossword will be sent to your inbox so you can resume it.</small><br /><br />"),e.push("<input type='text' class='form-control' id='email' />");else if("report"===t){var o="Ex: The crossword is misspelled, the definitions are wrong or are insulting or make no sense, some words do not exist, etc";e.push("<strong>You think this crossword should be removed or fixed?</strong><br />"),e.push("Use the text area bellow to let us know what you encounter wrong so we can take care of it.<br />"),e.push("<small>Please, try to send your feedback in english, be brief and clear in your exposition. We appreciate your help!</small><br /><br />"),e.push("<textarea id='complaint' class='form-control' style='height: 75px !important' placeholder='"+o+"'></textarea>")}return e.join("")},this.getComplexity=function(t){var a=layout.words.hor.length+layout.words.ver.length;if(0!==a){var e=t/a;data.complexity=(e+t)/MAX_LEVEL*100,showModal("info",largeModals("complexity",{chars:t,average:e}),["dismiss"])}},this.getAuthor=function(t){showModal("data",largeModals("author",t||""),["continue","dismiss"]);var a=$("#modal-button-continue");a.on("click",function(){var t=$("#email");checkEmail(t.val())?sendAuthor(t.val()):t.val("Incorrect Email")})},this.getNick=function(t){showModal("data",largeModals("nicks"),["continue","dismiss"]);var a=getLang(""),e=$("input[name='author']"),o=$("input[type='radio']"),s=$("div.alert"),n=$("#modal-button-continue");"N/A"!==data.nick.label&&e.val(data.nick.label),void 0!==t&&s.removeClass("hide").text(t),o.on("click",function(){e.val($(this).attr("data-val"))}),e.on("keyup",function(){o.each(function(){$(this).prop("checked",$(this).attr("data-val")===$.trim(e.val()))}),$(this).val($(this).val().replace(LOCK_CHARS,""))}),n.on("click",function(){""===e.val()||0===a.prop("selectedIndex")?s.removeClass("hide").text("Please, fill the information above"):(data.send={nick_id:o.filter(function(){return $(this).prop("checked")===!0}).val(),nick_label:e.val(),language:a.val()},void 0===data.send.nick_id?callAjax("/settings/nick",{nick:e.val()}).done(function(t){t=$.parseJSON(t),"false"===t?showModal("captcha","",["continue","dismiss"],sendValidation):getNick(t)}).fail(function(){handleError()}):showModal("captcha","",["continue","dismiss"],sendValidation))})},this.sendAuthor=function(t){callAjax("/settings/author",{author:t}).done(function(t){""===t?getAuthor("Incorrect Email"):"error"===t?handleError():(t=$.parseJSON(t),void 0===t.author?(data.author=t.id,data.nicks=[],$.each(t.nick,function(){data.nicks.push({id:this.id,label:this.label})}),data.user=t.contact):(data.author=t.author,data.nicks=""),getNick())}).fail(function(){handleError()})},this.sendValidation=function(){var t=$("#modal-button-continue");t.on("click",function(){var t=$("form");callAjax("/settings/validate",t.serialize()).done(function(t){t=$.parseJSON(t),t===!0?void 0===data.contact?sendData():""===data.contact?sendReport():sendProgress():showModal("captcha","",["continue","dismiss"],sendValidation)}).fail(function(){handleError()})})},this.sendData=function(){var notes=$("textarea.notes"),aux=[];$.each(layout.cells,function(){aux.push(Number(""!==this.val))}),getDefinitions(),aux={scheme:aux.join(""),layout:JSON.stringify(layout),author:data.author,complexity:data.complexity,id:data.id,user:data.user,label:data.send.nick_label,language:data.send.language,published:data.pub,notes:notes.val()},callAjax("/settings/save",aux).done(function(res){res=$.parseJSON(res),"DELETED"===res?window.location.reload():res.indexOf(":")>-1?eval(res):resetValues(res)}).fail(function(){handleError()})},this.sendProgress=function(val){var progress=[],aux=$("div.canvas input");aux.each(function(){progress.push($(this).val())}),aux=$("#progress"),callAjax("/settings/progress",{id:aux.attr("data-ref"),crossword:data.id,contact:data.contact,progress:progress.join(",")}).done(function(res){res=$.parseJSON(res),"start"===data.mode?res.indexOf(":")>-1&&eval(res):"true"===res?showModal("info","Your progress on this crossword has been successfully updated",["dismiss"]):handleError()}).fail(function(){handleError()})},this.sendReport=function(){callAjax("/settings/report",{crossword:data.id,complaint:data.complaint}).done(function(t){if(t=$.parseJSON(t),"DELETED"===t){var a=function(){var t=$("#modal-button-continue");t.on("click",function(){window.location=HOST})};showModal("info","<strong>This crossword was already removed</strong><br />Thank you for contacting us.",["continue"],a)}else showModal("info","<strong>Your feedback was sent successfully!</strong><br />Thank you for contacting us.",["dismiss"])}).fail(function(){handleError()})},this.getPosition=function(t){for(var a,e="left"===t||"top"===t?0:"right"===t?COLS-1:ROWS-1,o="right"===t||"bottom"===t?-1:"left"===t?COLS:ROWS,s="left"===t||"right"===t?"col":"row",n=$("div.canvas input"),u=e,i=o;"left"===t||"top"===t?i>u:u>i;"left"===t||"top"===t?u++:u--)if(a=n.filter(function(){return $(this).attr(s)==u&&""!==inspectCellValue($(this).val())}),a.length)return u},this.resetWords=function(){layout.words.hor.clean(),layout.words.ver.clean()},this.resetValues=function(t){var a;data.lang=data.send.language,data.nick.id=data.send.nick_id,data.nick.label=data.send.nick_label,"false"!==t&&(data.published=t,a=$("a[data-action='publish']"),a.remove()),a=$("nav div.blockquote small"),a.eq(0).text(data.nick.label),a.eq(1).text(data.lang),a.eq(2).find("span").text(parseFloat(Number(data.complexity).toFixed(2))),a.eq(3).text(data.published),showModal("info","The crossword has been successfully "+("false"===t?"saved":"published"),["dismiss"])},this.matchValues=function(t,a){return t===a||t===a.toLowerCase()||t===a.toUpperCase()},this.getDefinitions=function(){var t=$("ol textarea"),a=0;t.each(function(t){layout.words[$(this).attr("data-dir")]["hor"==$(this).attr("data-dir")?t:a++].def=curlyQuotes($(this).val())})},this.getMessage=function(t){var a=["This command can be run just in edit mode.<br /><strong>Please, switch to edit mode to proceed.</strong>","Are you sure you want to remove all inserted characters from the crossword?<br /><strong>This action will set a blank crossword.</strong>","Are you sure you want to reload the crossword?<br /><strong>All changes that have not been saved will get lost.</strong>","To save your changes or publish your crossword you need to build the crossword first.<br /><strong>Please, switch to build mode to proceed.</strong>","The crossword must have at least a <strong class='text-danger'>"+MIN_COMPLEXITY+" degrees of complexity</strong> to be saved.","The crossword must have at least a <strong class='text-danger'>"+2*MIN_COMPLEXITY+" degrees of complexity</strong> to be published.","Are you sure you want to delete this crossword?<br /><strong>This action cannot be reverted!</strong>","<strong>Congratulations!</strong><br />You have completed this crossword. Don't forget to sharing it with your friends if you enjoyed it.","Are you sure you want to reveal the solution of this crossword?<br /><strong>Don't give up and try harder!</strong>","Are you sure you want to discard your saved work on this crossword?","This crossword is already published and must have at least a <strong class='text-danger'>"+2*MIN_COMPLEXITY+" degrees of complexity</strong> to be saved."];
return a[t]},this.showMessage=function(t){showModal("warning",getMessage(t),["dismiss"])},this.findActiveItem=function(){for(var t=$("select option"),a=0,e=t.length;e>a;a++)if(t.eq(a).val()===data.lang){t.parent().prop("selectedIndex",a);break}},this.checkEmail=function(t){var a=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return a.test(t)},this.handleError=function(){showModal("warning","We can process your request at this moment.<br /><strong>Please, try again later</strong>",["dismiss"])},this.curlyQuotes=function(t){return t=t.replace(/(^|[-\u2014\s(\["])'/g,"$1‘"),t=t.replace(/'/g,"’"),t=t.replace(/(^|[-\u2014/\[(\u2018\s])"/g,"$1“"),t=t.replace(/"/g,"”"),t=t.replace(/--/g,"—")};var sendSupport=function(){var t=$("form button[type='button']");t.on("click",function(){var t=$("form");callAjax("/contact",t.serialize()).done(function(a){a=$.parseJSON(a);var e=$("span.help-block");showModal("warning",e.eq(a).text(),["dismiss"]),5===a&&t.reset()}).fail(function(){handleError()})})};this.support=$("#contact"),support.length&&sendSupport()}();